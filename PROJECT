* REPLICATION PROJECT
cd "/Users/josephinelaguardia/Desktop/micro_x/paper to replicate"

* First data base: ACS records
use "daca_acs.dta"

* We need to keep only immigrant individuals, thus when everimmig = 1. Then, we 
* won't need this variable anymore.

drop if everimmig == 0

* Variables of interest : fertility outcomes => child0 nchild fertyr
* Variables of interest : regressors => eligible eligiblepost 
* Variables of interest : control variables => ageyr yrimmig age
* Variables of interest : fixed effects => ageimmig statefip 
* other variables to keep : noncitizen post year_elig

keep child0 nchild fertyr eligible eligiblepost ageyr yrimmig age ageimmig statefip noncitizen post year_elig year

* Second data base: YRBSS records
use "daca_yrbss.dta"

drop if sexact == .
drop weight highhispelig

clear
* Replicate Figure 1
use "daca_acs_clean.dta"

* coding the share of hispanic youth with no children

bys year noncitizen, sort: egen rate = mean(child0)
tw (line rate year if noncitizen == 0, lpattern(dash) lcolor(black)) (line rate year if noncitizen == 1, lcolor(black)), ///
   ytitle("Share of 15-20 with No Children") ///
   xtitle("Year") ///
   legend(order(1 "Hispanic Immig. Citizens" 2 "Hispanic Immig. Non-Citizens"))
 
* Things to do: find the restriction in order to have the same graph. Hypothesis :
* there is a restriction in the data that we didn't find. Idea: look at the 
* sample size in the regressions.


* Replicate Table 1
keep if yrimmig <= 2007
keep if ageimmig <= 10

* not detrended 
  
regress fertyr eligible eligiblepost ageyr yrimmig c.year##statefip c.ageimmig##eligible
estimates store rg1

regress child0 eligible eligiblepost ageyr yrimmig c.year##statefip c.ageimmig##eligible
estimates store rg2

regress nchild eligible eligiblepost ageyr yrimmig c.year##statefip c.ageimmig##eligible
estimates store rg3

estout rg1tris rg2tris rg3tris, cells(b(star fmt(3)) se(par fmt(2)))   ///
   legend label varlabels(_cons constant)               ///
   stats(r2 df_r bic, fmt(3 0 1) label(R-sqr dfres BIC))
   


* on-detrended data

